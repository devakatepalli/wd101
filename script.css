document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("registration-form");
    const tableBody = document.querySelector("#data-table tbody");

    // Load saved data on page load
    function loadTableData() {
        let users = JSON.parse(localStorage.getItem("users")) || [];
        tableBody.innerHTML = "";
        users.forEach(user => {
            let row = tableBody.insertRow();
            row.innerHTML = `<td>${user.name}</td>
                             <td>${user.email}</td>
                             <td>${user.password}</td>
                             <td>${user.dob}</td>
                             <td>${user.terms}</td>`;
        });
    }

    // Date Validation (18-55 years)
    document.getElementById("dob").addEventListener("input", function () {
        let dob = new Date(this.value);
        let today = new Date();
        let age = today.getFullYear() - dob.getFullYear();
        let monthDiff = today.getMonth() - dob.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
            age--;
        }
        
        if (age < 18 || age > 55) {
            this.setCustomValidity("Age must be between 18 and 55.");
        } else {
            this.setCustomValidity("");
        }
    });

    form.addEventListener("submit", function (event) {
        event.preventDefault();

        let userData = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            password: document.getElementById("password").value,
            dob: document.getElementById("dob").value,
            terms: document.getElementById("terms").checked
        };

        let users = JSON.parse(localStorage.getItem("users")) || [];
        users.push(userData);
        localStorage.setItem("users", JSON.stringify(users));

        loadTableData();
        form.reset();
    });

    loadTableData();
});
